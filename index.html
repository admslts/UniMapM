<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Authentication</title>
    <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
</head>
<body>

<h1>Access with QR Code</h1>

<!-- Display video feed for scanning QR code -->
<video id="qr-video" width="300" height="300"></video>

<!-- Display authentication status -->
<p id="auth-status">Scan QR Code to Access</p>

<script>
    // Function to extract token from URL parameters
    function getTokenFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('token');
    }

    // Function to perform server-side token validation
    function validateToken(token) {
        // Simulate a server request for validation
        const validToken = "your_secret_token";  // Replace with your server-side logic
        return token === validToken;
    }

    // Function to handle successful authentication
    function authenticationSuccess() {
        document.getElementById("auth-status").textContent = "Authentication Successful!";
        // Display the content or redirect to the authenticated page
        document.body.innerHTML = "<h1>Welcome to the secured content!</h1>";
    }

    // Function to handle authentication failure
    function authenticationFailure() {
        document.getElementById("auth-status").textContent = "Invalid or missing token. Authentication Failed.";
    }

    // Initialize QR code scanner
    function initQRCodeScanner() {
        const video = document.getElementById("qr-video");

        html5Qrcode.scan(
            "qr-video",
            { fps: 10 },
            (data) => {
                // Handle QR code data
                console.log("QR Code data:", data);

                // Validate the token on the server side
                const isValid = validateToken(data);

                if (isValid) {
                    // Successful authentication
                    authenticationSuccess();
                } else {
                    // Invalid token
                    authenticationFailure();
                }

                // Stop scanning after authentication attempt (you can adjust this logic)
                html5Qrcode.stop();
            },
            (error) => {
                // Handle errors
                console.error("QR Code scanning error:", error);
            },
            (videoError) => {
                // Handle video streaming errors
                console.error("Video streaming error:", videoError);
            }
        );
    }

    // Call the QR code scanner initialization function on page load
    initQRCodeScanner();
</script>

</body>
</html>
