<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Login with QR Code</title>
    <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
</head>
<body>

<h1>Auto Login with QR Code</h1>

<!-- Display video feed for scanning QR code -->
<video id="qr-video" width="300" height="300"></video>

<!-- Display login status -->
<p id="login-status">Scanning QR Code...</p>

<script>
    // Function to perform server-side token validation
    function validateToken(token) {
        // Simulate a server request for validation
        const validToken = "your_secure_token";  // Replace with your server-side logic
        return token === validToken;
    }

    // Function to handle successful login
    function loginSuccess() {
        document.getElementById("login-status").textContent = "Login Successful!";
        // Redirect to the authenticated user's page or perform other actions
        setTimeout(function() {
            window.location.href = "/dashboard";
        }, 2000);  // Redirect after 2 seconds (for demonstration)
    }

    // Function to handle login failure
    function loginFailure() {
        document.getElementById("login-status").textContent = "Invalid or missing token. Login Failed.";
    }

    // Initialize QR code scanner
    function initQRCodeScanner() {
        const video = document.getElementById("qr-video");

        html5Qrcode.scan(
            "qr-video",
            { fps: 10 },
            (data) => {
                // Handle QR code data
                console.log("QR Code data:", data);

                // Validate the token on the server side
                const isValid = validateToken(data);

                if (isValid) {
                    // Successful login
                    loginSuccess();
                } else {
                    // Invalid token
                    loginFailure();
                }

                // Stop scanning after login attempt (you can adjust this logic)
                html5Qrcode.stop();
            },
            (error) => {
                // Handle errors
                console.error("QR Code scanning error:", error);
                loginFailure();  // Treat scanning errors as login failures
            },
            (videoError) => {
                // Handle video streaming errors
                console.error("Video streaming error:", videoError);
                loginFailure();  // Treat streaming errors as login failures
            }
        );
    }

    // Call the QR code scanner initialization function on page load
    initQRCodeScanner();
</script>

</body>
</html>
